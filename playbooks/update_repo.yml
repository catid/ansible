---
- name: Update upsampling repository
  hosts: all
  vars_files:
    - sudo.yml
  tasks:
    - name: Ensure git is installed
      ansible.builtin.package:
        name: git
        state: present
      become: yes

    - name: Git pull on ~/sources/upsampling
      ansible.builtin.git:
        repo: git@github.com:catid/upsampling.git
        dest: "{{ lookup('env', 'HOME') }}/sources/upsampling"
        update: yes
        accept_hostkey: yes

    - name: Update pip with any newly added requirements
      shell: |
        cd "{{ lookup('env', 'HOME') }}/sources/upsampling"
        "{{ lookup('env', 'HOME') }}/mambaforge/envs/upsampling/bin/pip" install --upgrade -r requirements.txt
