---
- name: Update upsampling repository
  hosts: all
  vars_files:
    - sudo.yml
  tasks:
    - name: Ensure git is installed
      ansible.builtin.package:
        name: git
        state: present
      become: yes

    - name: Git pull on ~/sources/upsampling
      ansible.builtin.git:
        repo: git@github.com:catid/upsampling.git
        dest: "~/sources/upsampling"
        update: yes
        accept_hostkey: yes

    - name: Update pip with any newly added requirements
      shell: |
        cd ~/sources/upsampling
        ~/miniconda3/bin/conda activate upsampling
        ~/miniconda3/envs/upsampling/bin/pip install -r requirements.txt
